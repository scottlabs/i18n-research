define(function() {
function encodeHTMLSource() {  var encodeHTMLRules = { "&": "&#38;", "<": "&#60;", ">": "&#62;", '"': '&#34;', "'": '&#39;', "/": '&#47;' },  matchHTML = /&(?!#?w+;)|<|>|"|'|\//g;  return function() {    return this ? this.replace(matchHTML, function(m) {return encodeHTMLRules[m] || m;}) : this;  };};
String.prototype.encodeHTML=encodeHTMLSource();
var tmpl = {};
  tmpl['compositeRouter']=function anonymous(it) {
var out='\n\ndefine([\n\n  \'backbone\',\n  \'jquery\',\n  ';var arr1=it.imports;if(arr1){var _import,index=-1,l1=arr1.length-1;while(index<l1){_import=arr1[index+=1];out+='\n    \''+(_import.view.path)+'\',\n    \''+(_import.model.path)+'\'\n    ';if(index !== it.imports.length - 1){out+=',';}out+='\n  ';} } out+='\n\n], function(\n\n  Backbone,\n  $,\n  ';var arr2=it.imports;if(arr2){var _import,index=-1,l2=arr2.length-1;while(index<l2){_import=arr2[index+=1];out+='\n    '+(_import.view.name)+',\n    '+(_import.model.name)+'\n    ';if(index !== it.imports.length - 1){out+=',';}out+='\n  ';} } out+='\n\n) {\n\n  var Constructor = Backbone.Router.extend({\n\n    routes : {\n    ';var arr3=it.pages;if(arr3){var page,index=-1,l3=arr3.length-1;while(index<l3){page=arr3[index+=1];out+='\n      \''+(page.path)+'\' : \'compose '+(page.path)+'\'\n      ';if(index !== it.pages.length - 1){out+=',';}out+='\n    ';} } out+='\n    },\n\n    ';var arr4=it.pages;if(arr4){var page,index=-1,l4=arr4.length-1;while(index<l4){page=arr4[index+=1];out+='\n      \'compose '+(page.path)+'\': function() {\n        var _this = this\n          , incorrectRegions = 0\n          , n = 0;\n\n        app.document.trigger(\'fetchstart\', \''+(page.path)+'\');\n\n        '+(page.contentScript)+'\n\n        for(var view in app.views) {\n          if('+(page.noViewsScript)+') {\n            app.views[view].remove();\n            delete app.views[view];\n            if(typeof app.models[view] !== \'undefined\') {\n              Backbone.Relational.store.unregister(app.models[view]);\n              delete app.models[view];\n            }\n          }\n        }\n      },\n    ';} } out+='\n\n    ';var arr5=it.pages;if(arr5){var page,index=-1,l5=arr5.length-1;while(index<l5){page=arr5[index+=1];out+='\n    \'render '+(page.path)+'\': function() {\n      app.document.trigger(\'renderstart\');\n      if(document.querySelectorAll(\'[data-layout='+(page.layout)+']\').length) {\n        '+(page.renderScript)+'\n      }\n      else {\n        app.$layout.remove();\n        app.$body.append(app.layoutTmpls.'+(page.layout)+'({\n          '+(page.mapScript)+'\n        }));\n      }\n\n      app.document.trigger(\'renderend\');\n    },\n    ';} } out+='\n  });\n\n  Constructor.prototype.content = {};\n  return Constructor;\n});\n';return out;
};
  tmpl['contentScript']=function anonymous(it) {
var out='\n\nthis.should = {};\n';var arr1=it;if(arr1){var content,index=-1,l1=arr1.length-1;while(index<l1){content=arr1[index+=1];out+='\n  if(typeof app.views.'+(content.model.toLowerCase())+' === \'undefined\' || app.views.'+(content.model.toLowerCase())+'.should(\''+(content.path)+'\') === \'update\') {\n    if(typeof app.views.'+(content.model.toLowerCase())+' === \'undefined\') {\n      if(!document.querySelector(\'[data-content="'+(content.model.toLowerCase())+'"]\')) {\n        this.should[\''+(content.model.toLowerCase())+'\'] = \'update\';\n      }\n      else {\n        this.should[\''+(content.model.toLowerCase())+'\'] = \'keep\';\n      }\n    }\n    else {\n      this.should[\''+(content.model.toLowerCase())+'\'] = app.views.'+(content.model.toLowerCase())+'.should(\''+(content.path)+'\');\n      Backbone.Relational.store.unregister(app.models.'+(content.model.toLowerCase())+');\n    }\n    app.models.'+(content.model.toLowerCase())+' = new '+(content.model)+';\n    app.views.'+(content.model.toLowerCase())+' = new '+(content.view)+'(app.models.'+(content.model.toLowerCase())+');\n      incorrectRegions++;\n      setTimeout(function() {\n        try {\n          app.models.'+(content.model.toLowerCase())+'.fetch({\n            success: function() {\n              _this.content[\''+(content.region)+'\'] = app.views.'+(content.model.toLowerCase())+'.toHTML();\n              if(typeof app.views.'+(content.model.toLowerCase())+'.bindModel === \'function\') {\n                app.views.'+(content.model.toLowerCase())+'.bindModel();\n              }\n              n++;\n              if(n === incorrectRegions) {\n                app.document.trigger(\'fetchend\', \''+(content.path)+'\');\n                _this[\'render '+(content.path)+'\']();\n              }\n            }\n          });\n        }\n        catch(err) {\n          if(err.message === \'A "url" property or function must be specified\') {\n            _this.content[\''+(content.region)+'\'] = app.views.'+(content.model.toLowerCase())+'.toHTML();\n            n++;\n            if(n === incorrectRegions) {\n              app.document.trigger(\'fetchend\', \''+(content.path)+'\');\n              _this[\'render '+(content.path)+'\']();\n            }\n          }\n          else {\n            throw err;\n          }\n        }\n      }, 0);\n  }\n  else if(app.views.'+(content.model.toLowerCase())+'.should(\''+(content.path)+'\') === \'remove\') {\n    app.views.'+(content.model.toLowerCase())+'.hide();\n  }\n  else {\n    app.views.'+(content.model.toLowerCase())+'.show();\n  }\n';} } out+='\n';return out;
};
  tmpl['mapScript']=function anonymous(it) {
var out='\n\n';var arr1=it;if(arr1){var content,index=-1,l1=arr1.length-1;while(index<l1){content=arr1[index+=1];out+='\n  '+(content.region)+' : this.content[\''+(content.model.toLowerCase())+'\']\n  ';if(index !== it.length - 1){out+=',';}out+='\n';} } out+='\n';return out;
};
  tmpl['noViewsScript']=function anonymous(it) {
var out='\n';var arr1=it;if(arr1){var view,index=-1,l1=arr1.length-1;while(index<l1){view=arr1[index+=1];out+='\n  view !== \''+(view)+'\'\n  ';if(index !== it.length - 1){out+=' && ';}out+='\n';} } out+='\n';return out;
};
  tmpl['renderScript']=function anonymous(it) {
var out='\n\n';var arr1=it;if(arr1){var content,index=-1,l1=arr1.length-1;while(index<l1){content=arr1[index+=1];out+='\n    app.document.trigger(\'render'+(content.model.toLowerCase())+'start\');\n    try {\n      if(this.should[\''+(content.model.toLowerCase())+'\'] === \'update\') {\n        var $region = document.querySelector(\'[data-region="'+(content.region)+'"]\');\n        $region.innerHTML = this.content[\''+(content.region)+'\'];\n      }\n      if(app.views.el !== \'<div></div>\') {\n        app.views.'+(content.model.toLowerCase())+'.setElement(\'[data-content="'+(content.model.toLowerCase())+'"]\');\n      }\n      if(!app.views.'+(content.model.toLowerCase())+'.boundDOM) {\n        app.views.'+(content.model.toLowerCase())+'.bindDOM();\n        app.views.'+(content.model.toLowerCase())+'.boundDOM = true;\n      }\n      if(typeof app.views.'+(content.model.toLowerCase())+'.onFinishRendering === \'function\') {\n        app.views.'+(content.model.toLowerCase())+'.onFinishRendering();\n      }\n    }\n    catch(err) {\n      throw err;\n    }\n    app.document.trigger(\'render'+(content.model.toLowerCase())+'end\');\n';} } out+='\n';return out;
};
  tmpl['jsonScript']=function anonymous(it) {
var out='\n\n\n<script type="application/json" class="js-json-'+(it.name||'').toString().encodeHTML()+'">'+(it.json)+'</script>\n';return out;
};
return tmpl;});
